id: 'awtrix_person3_status_pixel'
alias: 'Awtrix person3 status pixel'
initial_state: 'on'
trigger:
  - platform: state
    entity_id: person.person3
    to: ~
  - platform: state
    entity_id: proximity.person3_home
  - platform: state
    entity_id: input_boolean.office_occupied
    to: 'on'
variables:
  status_colour: >-
    {{ "[0,64,0]" if is_state('person.person3','home') else ( "[64,41,0]" if states('proximity.person3_home')|float < 500 else "[64,0,0]") }}
condition:
  - condition: state
    entity_id: input_boolean.office_occupied
    state: 'on'
action:
  - service: mqtt.publish
    data:
      qos: 0
      retain: false
      payload: |-
        {
          "color": {{ status_colour }}
        }
      topic: awtrix_6d6f50/indicator1
