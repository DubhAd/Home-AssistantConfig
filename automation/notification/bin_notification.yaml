id: 'bin_notification'
initial_state: 'on'
alias: 'Bin notification'
trigger:
  - platform: time_pattern
    minutes: '/5'
    seconds: '30'
condition:
  - condition: state
    entity_id: input_boolean.living_room_occupied
    state: 'on'
  - condition: or
    conditions:
      - condition: state
        entity_id: sensor.next_bin_collection
        state: 'tomorrow'
      - condition: and
        conditions:
          - condition: time
            before: '09:00:00'
          - condition: state
            entity_id: sensor.next_bin_collection
            state: 'today'
variables:
  icon: >-
    {% if is_state_attr('sensor.next_bin_collection','bin_type','grey') %}
      12155
    {% elif is_state_attr('sensor.next_bin_collection','bin_type','green') %}
      12059
    {% elif is_state_attr('sensor.next_bin_collection','bin_type','blue') %}
      12060
    {% elif is_state_attr('sensor.next_bin_collection','bin_type','brown') %}
      12442
    {% endif %}
action:
  - delay: '00:01:00'
  - if:
      - condition: state
        entity_id: input_boolean.use_lametric
        state: 'on'
    then:
      - service: notify.logfile
        data:
          message: >-
            SENDLIVING {{ states('sensor.next_bin_collection')|title }} the {{ state_attr('sensor.next_bin_collection','bin_type') }} bin is being collected
  - if:
      - condition: state
        entity_id: input_boolean.use_awtrix_living_room
        state: 'on'
    then:
      - service: notify.awtrix_living_room
        data:
          message: >-
            {{ states('sensor.next_bin_collection')|title }} the {{ state_attr('sensor.next_bin_collection','bin_type') }} bin is being collected
          data:
            icon: "{{ icon }}"
            duration: 30
            repeat: 2
