id: 'unlock_front_door'
alias: 'Unlock front door'
initial_state: 'on'
trigger:
  - platform: state
    entity_id:
      - binary_sensor.drive_car_occupancy
      - binary_sensor.drive_person_occupancy
      - binary_sensor.front_path_person_occupancy
condition:
  - condition: or
    conditions:
      - condition: state
        entity_id:
          - input_select.person3_status_dropdown
          - input_select.person1_status_dropdown
          - input_select.person2_status_dropdown
        state: 'Pre Arrival'
        match: any
      - condition: and
        conditions:
          - condition: state
            entity_id: input_boolean.person3_home
            state: 'off'
          - condition: numeric_state
            entity_id: proximity.person3_home
            below: 30
      - condition: and
        conditions:
          - condition: state
            entity_id: input_boolean.person1_home
            state: 'off'
          - condition: numeric_state
            entity_id: proximity.person1_home
            below: 30
      - condition: and
        conditions:
          - condition: state
            entity_id: input_boolean.person2_home
            state: 'off'
          - condition: numeric_state
            entity_id: proximity.person2_home
            below: 30
action:
  - service: lock.unlock
    data:
      entity_id: lock.front_door
